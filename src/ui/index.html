<html>
<script src="http://threejs.org/build/three.min.js"></script>

<script src="http://threejs.org/examples/js/libs/tween.min.js"></script>

<script src="http://threejs.org/examples/js/libs/stats.min.js"></script>
<script src="https://unpkg.com/three@0.85.0/examples/js/controls/OrbitControls.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://threejsfundamentals.org/threejs/resources/threejs/r103/js/loaders/LoaderSupport.js"></script>
<script src="https://threejsfundamentals.org/threejs/resources/threejs/r103/js/loaders/OBJLoader2.js"></script>
<script src="https://threejsfundamentals.org/threejs/resources/threejs/r103/js/loaders/MTLLoader.js"></script>

<head>
	<title>Star Wars RL</title>
	<style>
		body {
			margin: 0;
		}

		canvas {
			width: 100%;
			height: 100%
		}
	</style>
</head>

<body>
	<script>

		init();
		animate();

		//3D title
		var fontLoader = new THREE.FontLoader();

		fontLoader.load( 'https://cdn.rawgit.com/redwavedesign/ccb20f24e7399f3d741e49fbe23add84/raw/402bcf913c55ad6b12ecfdd20c52e3047ff26ace/bebas_regular.typeface.js', function ( font ) {
  		var fontMaterial = new THREE.MeshPhongMaterial( { color: (20,40,80), specular: (20,40,80), shininess: 30 } );
  			var text3d = new THREE.TextGeometry( 'Star Wars RL...lol', {
				font: font,
				size: 6,
				height: 1,
				curveSegments: 2,
				bevelEnabled: true,
				bevelThickness: 1,
				bevelSize: 1,
				bevelSegments: 1
			} );
  			var title3D = new THREE.Mesh( text3d, fontMaterial );
			title3D.position.x = -30;
			title3D.position.y = 20;
			title3D.position.z = 20;
			scene.add(title3D);
		} );



		// google-chrome --allow-file-access-from-files &

		// Load CSV data
		var url = "data.csv";

		var request = new XMLHttpRequest();
		request.open("GET", url, false);
		request.send(null);

		var csvData = new Array();
		var jsonObject = request.responseText.split(/\r?\n|\r/);
		for (var i = 0; i < jsonObject.length; i++) {
			csvData.push(jsonObject[i].split(','));
		}

		{
    const objLoader = new THREE.OBJLoader2();
    objLoader.loadMtl('../../models/deathstar.mtl', null, (materials) => {
      objLoader.setMaterials(materials);
      objLoader.load('../../models/deathstar.obj', (event) => {
        const root = event.detail.loaderRootNode;
		root.scale.set(0.1,0.1,0.1);
        scene.add(root);
      });
	});
  }

		// Lighting
		var spotLight = new THREE.SpotLight(0xFFFFFF, 2);
		spotLight.position.set(200, 250, 600);
		spotLight.target.position.set(100, -50, 0);
		spotLight.castShadow = true;
		scene.add(spotLight.target);
		scene.add(spotLight);
		spotLight.shadow.mapSize.width = 512; // default
		spotLight.shadow.mapSize.height = 512; // default
		spotLight.shadow.camera.near = 0.5; // default
		spotLight.shadow.camera.far = 15000; // default


		//Sphere 1
		var geometry = new THREE.SphereGeometry(15, 64, 64);
		var material = new THREE.MeshPhongMaterial({ color: 0x0087E6, shininess: 100 });
		var sphere = new THREE.Mesh(geometry, material);
		scene.add(sphere);

		// Cylinder
		var geometry = new THREE.CylinderGeometry( 1, 3, 30, 64 );
		var material = new THREE.MeshBasicMaterial( {color: 0x8E8E8E} );
		var cylinder = new THREE.Mesh( geometry, material );



		// Planet
		var geometry = new THREE.SphereGeometry(5, 32,32);
		var material = new THREE.MeshPhongMaterial({ color: 0x00FF4D, shininess: 100 });
		var planet = new THREE.Mesh(geometry, material);
		scene.add(planet);


		cylinder.position.y = 29;
		planet.position.y = 40;
		sphere.add(cylinder);


		var rand_y_max = 100;
		var grid_size = 9;

		// Move planet depending on CSV
		var i = 0;
		$(function () {
			var intervalID = setInterval(function () {

				if ((csvData[i][0] == csvData[i][2]) && (csvData[i][1] == csvData[i][3])){
					planet.material.color.setHex(0xFF0000);
				}else{
					planet.material.color.setHex(0x00FF4D);
				}

				agent_c = computeRotationXYZ(csvData[i][0], csvData[i][1]);
				// sphere.rotation.z += 0.01;
				sphere.rotation.x = agent_c[0];
				sphere.rotation.z = agent_c[1];




				i+=1;
				if(i >= csvData.length){i=1;}



			}, 1000);
			setTimeout(function () {
				clearInterval(intervalID);
			}, 1000000);
		});

		function getRandom(min, max) {
			return Math.random() * (max - min) + min;
		}

		function computeRotationXYZ(sx,sy) {
			x = (sx*2*Math.PI)/grid_size;
			y = (sy*2*Math.PI)/grid_size;
			z = 15;
			return [x,y,z];
		}


		function init() {
			renderer = new THREE.WebGLRenderer({ antialias: true });
			var width = window.innerWidth;
			var height = window.innerHeight;
			renderer.setSize(width, height);
			document.body.appendChild(renderer.domElement);

			scene = new THREE.Scene();
			scene.background = new THREE.Color('white');

			camera = new THREE.PerspectiveCamera(45, width / height, 1, 10000);
			camera.position.x = 0;
			camera.position.y = 10;
			camera.position.z = 100;
			camera.lookAt(new THREE.Vector3(0, 0, 0));

			controls = new THREE.OrbitControls(camera, renderer.domElement);

			var gridXZ = new THREE.GridHelper(100, 10);
			scene.add(gridXZ);

		}

		function animate() {
			controls.update();
			requestAnimationFrame(animate);
			renderer.render(scene, camera);
		}
	</script>
</body>

</html>
